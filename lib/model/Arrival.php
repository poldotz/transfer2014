<?php



/**
 * Skeleton subclass for representing a row from the 'arrival' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * Thu Apr 24 18:51:37 2014
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class Arrival extends BaseArrival
{
    public function preInsert(PropelPDO $con = null)
    {
        $rate = $this->getRate();
        if($rate){
            $this->setRateName($rate->getName());
        }
        $this->setFlight(strtoupper($this->getFlight()));
        return true;
    }


    private function getRate(){
        $booking = $this->getBooking();
        //$customer_id = $booking->getCustomerId();
        $vehicle_type_id = $booking->getVehicleTypeId();
        $dayOfWeek = date('w',strtotime($this->getDay()));
        $hour = $this->getHour();

        $rate = RatePeer::getRateByAttributes($dayOfWeek,$hour);

        return $rate;

    }

    public function preUpdate(PropelPDO $con = null)
    {
        $this->setFlight(strtoupper($this->getFlight()));
        return true;
    }

    public function getDriver(){
        $driver = sfGuardUserPeer::retrieveByPK($this->getDriverId());
        if($driver){
          return  $driver->getDriver();
        }
        else{
            return "";
        }
    }
    public function getLocalityFromName(){
        $locality_from = LocalityPeer::retrieveByPK($this->getLocalityFrom());
        if(isset($locality_from)){
            return $locality_from->getName();
        }
        else{
            return "";
        }
    }
    public function getLocalityToName(){
        $locality_to = LocalityPeer::retrieveByPK($this->getLocalityTo());
        if(isset($locality_to)){
            return $locality_to->getName();
        }
        else{
            return "";
        }
    }

}
